# extract longest contigs chromsomes for south population
vcftools --vcf freebayes.SNPs.filtered.final.recode.vcf --positions keep2 \
--chr scf7180002389923 --chr scf7180002350256 --chr scf7180002344082 --chr scf7180002361408 --chr scf7180002390306 --chr scf7180002362268 --chr scf7180002366220 --chr scf7180002364256 --chr scf7180002365841 --chr scf7180002389550 --chr scf7180002345736 --chr scf7180002357382 --chr scf7180002359337 --chr scf7180002390266 --chr scf7180002365616 --chr scf7180002389599 --chr scf7180002371565 --chr scf7180002389987 --chr scf7180002358044 --chr scf7180002366850 --chr scf7180002390054 --chr scf7180002389123 --chr scf7180002345480 --chr scf7180002368324 --chr scf7180002341759 --chr scf7180002341966 --chr scf7180002389420 --chr scf7180002360793 --chr scf7180002389651 --chr scf7180002390141 --chr scf7180002354046 --chr scf7180002365449 --chr scf7180002365667 --chr scf7180002358185 --chr scf7180002390165 --chr scf7180002389973 --chr scf7180002354614 --chr scf7180002389905 --chr scf7180002355410 --chr scf7180002370393 --chr scf7180002356193 --chr scf7180002373794 --chr scf7180002343138 --chr scf7180002389839 --chr scf7180002350170 --chr scf7180002345336 --chr scf7180002358421 --chr scf7180002340855 --chr scf7180002389624 --chr scf7180002368598 --chr scf7180002389852 --chr scf7180002350137 --chr scf7180002343060 --chr scf7180002389270 --chr scf7180002346562 --chr scf7180002365814 --chr scf7180002374913 --chr scf7180002365319 --chr scf7180002389716 --chr scf7180002390387 --chr scf7180002345660 --chr scf7180002390499 --chr scf7180002374745 --chr scf7180002341197 --chr scf7180002342700 --chr scf7180002348510 --chr scf7180002379201 --chr scf7180002353104 --chr scf7180002389286 --chr scf7180002365900 --chr scf7180002340888 --chr scf7180002341075 --chr scf7180002345277 --chr scf7180002390694 --chr scf7180002356823 --chr scf7180002344207 --chr scf7180002389449 --chr scf7180002340817 --chr scf7180002390238 --chr scf7180002366705 --chr scf7180002347411 --chr scf7180002390303 --chr scf7180002341789 --chr scf7180002389485 --chr scf7180002390443 --chr scf7180002340928 --chr scf7180002341057 --chr scf7180002341629 --chr scf7180002347784 --chr scf7180002389740 --chr scf7180002344538 --chr scf7180002389347 --chr scf7180002367745 --chr scf7180002390001 --chr scf7180002390147 --chr scf7180002350305 --chr scf7180002346148 --chr scf7180002366117 --chr scf7180002368716 --chr scf7180002347051 --chr scf7180002361902 --chr scf7180002366960 --chr scf7180002365651 --chr scf7180002354714 --chr scf7180002366365 --chr scf7180002389462 --chr scf7180002361778 --chr scf7180002368698 --chr scf7180002361826 --chr scf7180002379432 --chr scf7180002358529 --chr scf7180002389210 --chr scf7180002341500 --chr scf7180002347737 --chr scf7180002389729 --chr scf7180002363215 --chr scf7180002374244 --chr scf7180002348183 --chr scf7180002354190 --chr scf7180002371336 --chr scf7180002354272 --chr scf7180002390342 --chr scf7180002389618 --chr scf7180002390752 --chr scf7180002366203 --chr scf7180002358236 --chr scf7180002350504 --chr scf7180002389663 --chr scf7180002389864 --chr scf7180002389488 --chr scf7180002352753 --chr scf7180002340886 --chr scf7180002390542 --chr scf7180002351165 --chr scf7180002352478 --chr scf7180002368294 --chr scf7180002368310 --chr scf7180002369720 --chr scf7180002389505 --chr scf7180002389238 --chr scf7180002352163 --chr scf7180002367007 --chr scf7180002341928 --chr scf7180002372356 --chr scf7180002347727 --chr scf7180002390318 --chr scf7180002366494 --chr scf7180002367413 --chr scf7180002348826 --chr scf7180002346647 --chr scf7180002389520 --chr scf7180002345502 --chr scf7180002389254 --chr scf7180002345748 --chr scf7180002357976 --chr scf7180002345746 --chr scf7180002390511 --chr scf7180002362670 --chr scf7180002341405 --chr scf7180002367713 --chr scf7180002369284 --chr scf7180002370304 --chr scf7180002378407 --chr scf7180002353414 --chr scf7180002360050 --chr scf7180002348602 --chr scf7180002348696 --chr scf7180002342730 --chr scf7180002341567 --chr scf7180002365168 --chr scf7180002378314 --chr scf7180002344153 --chr scf7180002390291 --chr scf7180002378531 --chr scf7180002374557 --chr scf7180002378712 --chr scf7180002341503 --chr scf7180002343183 --chr scf7180002343207 --chr scf7180002343882 --chr scf7180002362521 --chr scf7180002389983 --chr scf7180002351658 --chr scf7180002390721 --chr scf7180002349258 --chr scf7180002360935 --chr scf7180002371063 --chr scf7180002389351 --chr scf7180002389698 --chr scf7180002354132 --chr scf7180002368471 --chr scf7180002389278 --chr scf7180002341328 --chr scf7180002350393 --chr scf7180002347279 --chr scf7180002350594 --chr scf7180002378733 --chr scf7180002389842 --chr scf7180002368444 --chr scf7180002366189 --chr scf7180002370077 --chr scf7180002343021 --chr scf7180002344283 --chr scf7180002390152 --chr scf7180002350195 --chr scf7180002369017 --chr scf7180002346810 --chr scf7180002343731 --chr scf7180002343011 --chr scf7180002389371 --chr scf7180002389650 --chr scf7180002389590 --chr scf7180002343589 --chr scf7180002346964 --chr scf7180002349245 --chr scf7180002381822 --chr scf7180002378693 --chr scf7180002350489 --chr scf7180002370477 --chr scf7180002349944 --chr scf7180002365920 --chr scf7180002353399 --chr scf7180002347324 --chr scf7180002389920 --chr scf7180002340815 --chr scf7180002361440 --chr scf7180002390414 --chr scf7180002389831 --chr scf7180002369693 --chr scf7180002349158 --chr scf7180002353541 --chr scf7180002350468 --chr scf7180002382030 --chr scf7180002365693 --chr scf7180002340808 --chr scf7180002365957 --chr scf7180002390577 --chr scf7180002345679 --chr scf7180002341114 --chr scf7180002389296 --chr scf7180002344823 --chr scf7180002381787 --chr scf7180002361663 --chr scf7180002340809 --chr scf7180002346108 --chr scf7180002358898 --chr scf7180002389959 --chr scf7180002340799 --chr scf7180002345043 --chr scf7180002365795 --chr scf7180002367071 --chr scf7180002369804 --chr scf7180002390126 --chr scf7180002366520 --chr scf7180002351444 --chr scf7180002378669 --chr scf7180002353023 --chr scf7180002342864 --chr scf7180002378143 --chr scf7180002389605 --chr scf7180002347780 --chr scf7180002348625 --chr scf7180002346674 --chr scf7180002389442 --chr scf7180002389883 \
--recode --out test

# remove "scf" in chromosome name
awk '{gsub(/^scf/,""); print}' test.recode.vcf > tmp.vcf 

# create "west" and "south" subset
vcftools --vcf tmp.vcf --keep ../pop/west --recode --out freebayes.SNPs.filtered.final.west
vcftools --vcf tmp.vcf --keep ../pop/south --recode --out freebayes.SNPs.filtered.final.south

# create input using SNPfiltered SNPs and MAF > 5%
vcf-query freebayes.SNPs.filtered.final.south.recode.vcf -f '%CHROM\t%POS\t%REF\t[%GT]\n' | awk '{gsub ( "/","" ) ; print $0 }' >south.popdata
vcf-query freebayes.SNPs.filtered.final.west.recode.vcf -f '%CHROM\t%POS\t%REF\t[%GT]\n' | awk '{gsub ( "/","" ) ; print $0 }' >west.popdata

# copy west.popdata and south.popdata to software directory...start IBS
scp west.popdata ~/software/Inferring-demography-from-IBS
scp south.popdata ~/software/Inferring-demography-from-IBS

cd ~/software/Inferring-demography-from-IBS

#### prepare data
#within each pop
python parse_within_pop_allpairs.py south None 1
python parse_within_pop_allpairs.py west None 1
python parse_between_pops_allpairs.py west south None 1

## edit calc_ibs_backcoal_varmu.py to set mutaiton and recombination rate

#### run model with minimum tract length of 100, 10 simulations and ageneration time of 2 years for each population
python infer_onepop_adaptive_cumulative.py south_lengths.ibs 100 10 5
python infer_onepop_adaptive_cumulative.py west_lengths.ibs 100 10 5

#### run model, same as above, between populations
python infer_between_adaptive_cumulative.py west_vs_south_lengths.ibs 100 10 5

#### copy stout "parameters for plotting to vim demographic_history.txt
#### use "plot_between.py" if pop1_vs_pop2.ibs
python plot_onepop.py S_lengths.ibs demographic_history.txt demo.pdf




# plotting code for R
# Copy and paste inferred history to file called input.txt
data=read.table("input.txt",sep=":",row.names=1,fill=T)
my=as.matrix(str_split_fixed(data$V2, ", ", 7))
plot(1, type="n", xlab="", ylab="", xlim=c(0, 200000), ylim=c(0, 50))
k=100000

rect(k-(as.numeric(my[1,1])/2), 0, k+(as.numeric(my[1,1])/2), as.numeric(my[2,1]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,2])/2), as.numeric(my[2,1]), k+(as.numeric(my[1,2])/2), as.numeric(my[2,2]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,3])/2), as.numeric(my[2,2]), k+(as.numeric(my[1,3])/2), as.numeric(my[2,3]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,4])/2), as.numeric(my[2,3]), k+(as.numeric(my[1,4])/2), as.numeric(my[2,4]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,5])/2), as.numeric(my[2,4]), k+(as.numeric(my[1,5])/2), as.numeric(my[2,5]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,6])/2), as.numeric(my[2,5]), k+(as.numeric(my[1,6])/2), as.numeric(my[2,6]),density=20,col="gray",border="black")
rect(k-(as.numeric(my[1,7])/2), as.numeric(my[2,6]), k+(as.numeric(my[1,7])/2), as.numeric(my[2,7]),density=20,col="gray",border="black")





# dadi
# use python script from 
# https://github.com/mscharmann/python/blob/f0453609fc2112a48f6424f9cfa2ae094d94086b/vcf_to_dadi.py

# create site frequency spectrum
# python ../vcf2dadi.py --vcf ~/data/bam_fixrg_dedup/freebayes/freebayes.SNPs.filtered.final.maf005.recode.vcf --popmap ~/data/bam_fixrg_dedup/freebayes/popmap.txt
